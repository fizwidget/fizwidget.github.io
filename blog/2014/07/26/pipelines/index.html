
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pipelines! - fizwidget</title>
  <meta name="author" content="James Russell">

  
  <meta name="description" content="The concept of pipelining is pretty simple &ndash; a series of components are chained together such that the output from one flows into the input of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fizwidget.github.io/blog/2014/07/26/pipelines">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="fizwidget" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52561227-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">fizwidget</a></h1>
  
    <h2>cat /dev/random</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fizwidget.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pipelines!</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-26T12:45:10+09:30" pubdate data-updated="true">Jul 26<sup>th</sup>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The concept of pipelining is pretty simple &ndash; a series of components are chained together such that the output from one flows into the input of the next. In the world of software, Unix shell scripting is perhaps the canonical example:</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cat names <span class="p">|</span> grep <span class="s2">&quot;fred&quot;</span> <span class="p">|</span> uniq <span class="p">|</span> sort
</span></code></pre></td></tr></table></div></figure>


<p>Pipelining is also commonly used as a high-level system architecture. Consider a program that captures images from a camera, tags them with metadata, compresses them, then writes them to disk. It&rsquo;s not hard to see how this program could be structured as a series of four modules connected together in a pipeline.</p>

<p>So, pipelining&rsquo;s a neat idea, and it&rsquo;s used quite commonly. Unfortunately though, there&rsquo;s one area where it isn&rsquo;t used anywhere near as much as it should be: the lower-level implementation details of programs.</p>

<h2>An example</h2>

<p>Say we&rsquo;ve got a list of student objects, and we want to retrieve the email addresses of the ten youngest first-year CS students. How do we go about doing this? Most programmers would probably write something along these lines:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">emails</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'><span class="n">sorted_students</span> <span class="o">=</span> <span class="n">students</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:age</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">student</span> <span class="k">in</span> <span class="n">sorted_students</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">student</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">student</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="s2">&quot;CS&quot;</span>
</span><span class='line'>    <span class="n">email</span> <span class="o">=</span> <span class="n">student</span><span class="o">.</span><span class="n">email</span>
</span><span class='line'>    <span class="n">emails</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">emails</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">10</span>
</span><span class='line'>    <span class="k">break</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="n">emails</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code works, but it&rsquo;s difficult to read, error-prone, and relatively verbose. If we instead try to structure our solution as a pipeline, we&rsquo;ll see that what we really want to do is:</p>

<ol>
<li>Start with the list of all students.</li>
<li>Select the first-year students.</li>
<li>Select the students enrolled in CS degrees.</li>
<li>Take the 10 youngest students.</li>
<li>Retrieve their email addresses.</li>
</ol>


<p>Translating this into Ruby, we get:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">students</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">s</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class='line'>        <span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">s</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="s2">&quot;CS&quot;</span> <span class="p">}</span>
</span><span class='line'>        <span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:age</span><span class="p">)</span>
</span><span class='line'>        <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>        <span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:email</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ruby is particularly well suited to this style of coding, but it&rsquo;s also practical in many other languages. In Python for example, list comprehensions and the <code>itertools</code> module will come in handy.</p>

<p>It shouldn&rsquo;t be hard to see that the second code snippet is a big improvement over the first. It&rsquo;s easier to understand, easier to modify, and is therefore less error-prone. It also has the <em>potential</em> to run more efficiently (the runtime system could theoretically distribute the <code>select</code> and <code>collect</code> operations over multiple cores).</p>

<p>The difference here is really procedural vs functional, or more broadly, imperative vs declarative. The functional pipeline approach is declarative because we&rsquo;re describing <em>what</em> we want, rather than spelling out the details of <em>how</em> to achieve it.</p>

<h2>Conclusion</h2>

<p>The next time you think about writing a for-loop or an if-statement, consider whether you&rsquo;d be better served by a <code>collect</code> or a <code>select</code> ;)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">James Russell</span></span>

      








  


<time datetime="2014-07-26T12:45:10+09:30" pubdate data-updated="true">Jul 26<sup>th</sup>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/functional-programming/'>functional programming</a>, <a class='category' href='/blog/categories/pipelines/'>pipelines</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://fizwidget.github.io/blog/2014/07/26/pipelines/" data-via="" data-counturl="http://fizwidget.github.io/blog/2014/07/26/pipelines/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/07/06/implicit-futures-in-ruby/" title="Previous Post: Implicit Futures in Ruby">&laquo; Implicit Futures in Ruby</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/26/pipelines/">Pipelines!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/06/implicit-futures-in-ruby/">Implicit Futures in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/03/nothing-but-functions/">Nothing but Functions</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - James Russell -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fizwidget';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://fizwidget.github.io/blog/2014/07/26/pipelines/';
        var disqus_url = 'http://fizwidget.github.io/blog/2014/07/26/pipelines/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
